<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Dashboard</title>
    
    <!-- External Libraries -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="https://datamaps.github.io/scripts/0.4.4/datamaps.world.min.js"></script>
    <script src="centroids.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Button Styles */
.tab-button {
    background-color: #3498db; /* Blue color */
    color: white;
    border: 1px solid #2980b9; /* Slightly darker blue */
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 1em;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Hover effect for buttons */
.tab-button:hover {
    background-color: #2980b9; /* Darker blue when hovering */
    border-color: #1c5987;
    box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

/* Active button style */
.tab-button.active {
    background-color: #2ecc71; /* Green color for active state */
    border-color: #27ae60;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.tab-button:focus {
    outline: none;
}

/* Adjust button size and alignment in the chart-tabs section */
.chart-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-bottom: 20px;
}
/* Section Divider Styles */
.section-divider {
    border-top: 1px solid #ddd; /* Light gray border for the divider */
    margin: 40px 0; /* Add spacing around the divider */
}

/* Custom styling for dividers with text in between (optional) */
.section-divider-text {
    position: relative;
    text-align: center;
    margin-top: 20px;
    margin-bottom: 20px;
}

.section-divider-text::before,
.section-divider-text::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 40%;
    height: 1px;
    background-color: #ddd;
}

.section-divider-text::before {
    left: 0;
}

.section-divider-text::after {
    right: 0;
}

.section-divider-text span {
    position: relative;
    z-index: 1;
    font-size: 1em;
    font-weight: 600;
    color: #555;
    padding: 0 10px;
    background-color: #f4f4f4;
}

    </style>
</head>
<body>
    <div class="container">
        <h1>COVID-19 Dashboard</h1>

        <!-- World Cases and Deaths Section -->
        <section id="section1" class="section">
            <div class="section-header">
                <h2>World Cases and Deaths</h2>
            </div>
            <div class="kpi">
                <div class="kpi-item">
                    <h3>Total Cumulative Cases</h3>
                    <h4 id="total-cases"></h4>
                    <canvas id="cases-pie-chart"></canvas>
                </div>
                <div class="kpi-item">
                    <h3>Total Cumulative Deaths</h3>
                    <h4 id="total-deaths"></h4>
                    <canvas id="deaths-pie-chart"></canvas>
                </div>
                <div class="kpi-item">
                    <h3>Last Reported Date</h3>
                    <h4 id="last-date"></h4>
                    <h3>Cases on Last Day</h3>
                    <h4 id="last-day-cases"></h4>
                    <h3>Deaths on Last Day</h3>
                    <h4 id="last-day-deaths"></h4>
                    <h3>Percentage Change from Previous Days</h3>
                    <h4 id="percent-change-cases"></h4>
                    <h4 id="percent-change-deaths"></h4>
                </div>
            </div>
        </section>
        <div class="section-divider"></div>

        <!-- Global Charts Section -->
        <section id="section2" class="section">
            <div class="section-header">
                <h2>Global Impact Visualization</h2>
            </div>
            <div class="charts">
                <div id="worldMap"></div>
            </div>
            <div class="charts">
                <!-- Tabs for toggling charts (local to this section) -->
                <div class="chart-tabs">
                    <button class="tab-button active" data-chart="chart1">Total Cumulative Cases over Time</button>
                    <button class="tab-button" data-chart="chart2">Total Cumulative Deaths over Time</button>
                    <button class="tab-button" data-chart="chart3">Variation in New Cases by Country</button>
                    <button class="tab-button" data-chart="chart4">Variation in New Deaths by Country</button>
                </div>
                <!-- Chart containers (Initially only the first one is visible) -->
                <div class="chart-container" id="chart1" style="display: block;">
                    <h3>Total Cumulative Cases over Time</h3>
                    <canvas id="cumulative-cases-bar-chart"></canvas>
                </div>
                <div class="chart-container" id="chart2" style="display: none;">
                    <h3>Total Cumulative Deaths over Time</h3>
                    <canvas id="cumulative-deaths-bar-chart"></canvas>
                </div>
                <div class="chart-container" id="chart3" style="display: none;">
                    <h3>Variation in New Cases by Country</h3>
                    <canvas id="new-cases-line-chart"></canvas>
                </div>
                <div class="chart-container" id="chart4" style="display: none;">
                    <h3>Variation in New Deaths by Country</h3>
                    <canvas id="new-deaths-line-chart"></canvas>
                </div>
            </div>
        </section>
        <div class="section-divider"></div>

        <!-- Hospitalization Section -->
        <section id="section3" class="section">
            <div class="section-header">
                <h2>Hospitalization Data</h2>
            </div>
            <div class="kpi">
                <div class="kpi-item">
                    <h3>Total Adult Admissions</h3>
                    <p id="totalAdultAdmissions"></p>
                </div>
                <div class="kpi-item">
                    <h3>Total Pediatric Admissions</h3>
                    <p id="totalPediatricAdmissions"></p>
                </div>
                <div class="kpi-item">
                    <h3>Average Adult Admissions/Week</h3>
                    <p id="averageAdultAdmissions"></p>
                </div>
                <div class="kpi-item">
                    <h3>Average Pediatric Admissions/Week</h3>
                    <p id="averagePediatricAdmissions"></p>
                </div>
                <div class="kpi-item">
                    <h3>Bed Occupancy Rate</h3>
                    <p id="bedOccupancyRate"></p>
                </div>
            </div>
            <div class="charts">
                <!-- Tabs for toggling charts (local to this section) -->
                <div class="chart-tabs">
                    <button class="tab-button active" data-chart="hospitalChart1">Adult COVID Admissions</button>
                    <button class="tab-button" data-chart="hospitalChart2">Pediatric COVID Admissions</button>
                    <button class="tab-button" data-chart="hospitalChart3">Influenza Admissions</button>
                    <button class="tab-button" data-chart="hospitalChart4">Total COVID Admissions</button>
                </div>
                <!-- Chart containers (Initially only the first one is visible) -->
                <div class="chart-container" id="hospitalChart1" style="display: block;">
                    <h3>Adult COVID Admissions</h3>
                    <canvas id="adultCovidAdmissionsChart"></canvas>
                </div>
                <div class="chart-container" id="hospitalChart2" style="display: none;">
                    <h3>Pediatric COVID Admissions</h3>
                    <canvas id="pediatricCovidAdmissionsChart"></canvas>
                </div>
                <div class="chart-container" id="hospitalChart3" style="display: none;">
                    <h3>Influenza Admissions</h3>
                    <canvas id="influenzaAdmissionsChart"></canvas>
                </div>
                <div class="chart-container" id="hospitalChart4" style="display: none;">
                    <h3>Total COVID Admissions</h3>
                    <canvas id="totalAdmissionsChart"></canvas>
                </div>
            </div>
        </section>
        <div class="section-divider"></div>

        <!-- Vaccination Data Section -->
<section id="section4" class="section">
    <div class="section-header">
        <h2>Vaccination Data</h2>
    </div>
    <div class="charts">
        <!-- Tabs for toggling charts (local to this section) -->
        <div class="chart-tabs">
            <button class="tab-button active" data-chart="vaccinationChart1">Vaccination Rate vs Booster Dose Rate</button>
            <button class="tab-button" data-chart="vaccinationChart2">Breakdown of Vaccines Used</button>
            <button class="tab-button" data-chart="vaccinationChart3">Total Vaccinations by Country</button>
        </div>
        <!-- Chart containers (Initially only the first one is visible) -->
        <div class="chart-container" id="vaccinationChart1" style="display: block;">
            <h3>Vaccination Rate vs Booster Dose Rate</h3>
            <canvas id="scatter-plot"></canvas>
        </div>
        <div class="chart-container" id="vaccinationChart2" style="display: none;">
            <h3>Breakdown of Vaccines Used</h3>
            <canvas id="stacked-bar-chart"></canvas>
        </div>
        <div class="chart-container" id="vaccinationChart3" style="display: none;">
            <h3>Total Vaccinations by Country</h3>
            <div id="treemap"></div>
        </div>
    </div>
</section>
    </div>

    <script src="script.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
    // Function to toggle charts within each section
    function toggleCharts(sectionId) {
        const section = document.querySelector(`#${sectionId}`);
        const tabButtons = section.querySelectorAll(".tab-button");
        const chartContainers = section.querySelectorAll(".chart-container");

        tabButtons.forEach(button => {
            button.addEventListener("click", function() {
                // Remove active class from all buttons in this section
                tabButtons.forEach(btn => btn.classList.remove("active"));
                // Add active class to clicked button
                this.classList.add("active");

                // Hide all chart containers
                chartContainers.forEach(container => container.style.display = "none");

                // Show selected chart
                const chartToShow = this.getAttribute("data-chart");
                const selectedChart = section.querySelector(`#${chartToShow}`);
                if (selectedChart) {
                    selectedChart.style.display = "block";
                }
            });
        });

        // Ensure the first tab and chart are active by default
        if (tabButtons.length > 0) {
            tabButtons[0].classList.add("active");
            chartContainers[0].style.display = "block";
        }
    }

    // Apply toggleCharts to each section
    toggleCharts("section1"); // World Cases and Deaths Section
    toggleCharts("section2"); // Global Charts Section
    toggleCharts("section3"); // Hospitalization Section
    toggleCharts("section4"); // Vaccination Section

    // Load CSV data
    d3.csv('vaccination-data.csv', function(data) {
        // Parse the data
        data.forEach(function(d) {
            d.vaccinationRate = +d.PERSONS_VACCINATED_1PLUS_DOSE_PER100;
            d.totalVaccinations = +d.TOTAL_VACCINATIONS;
            d.numVaccineTypes = +d.NUMBER_VACCINES_TYPES_USED || 0; // Handle missing values
            d.boosterDoseRate = +d.PERSONS_BOOSTER_ADD_DOSE_PER100;
            d.country = d.COUNTRY;
        });

        // 1. Scatter Plot (Vaccination Rate vs Booster Dose Rate) - Your existing scatter plot
        const ctx1 = document.getElementById('scatter-plot').getContext('2d');
        const scatterPlot = new Chart(ctx1, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Vaccination Rate vs Booster Dose Rate',
                    data: data.map((d) => ({
                        x: d.vaccinationRate,
                        y: d.boosterDoseRate
                    })),
                    backgroundColor: 'rgba(75, 192, 192, 0.6)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: { 
                        title: { display: true, text: 'Vaccination Rate (%)' }
                    },
                    y: {
                        title: { display: true, text: 'Booster Dose Rate (%)' }
                    }
                }
            }
        });

        // 2. Bubble Chart (Vaccination Rate vs Total Vaccinations)
        const ctx2 = document.getElementById('bubble-chart').getContext('2d');
        const bubbleChart = new Chart(ctx2, {
            type: 'bubble',
            data: {
                datasets: [{
                    label: 'Vaccination Rate vs Total Vaccinations',
                    data: data.map((d) => ({
                        x: d.vaccinationRate,
                        y: d.totalVaccinations,
                        r: d.numVaccineTypes * 2 // Adjust the size of bubbles (based on number of vaccine types)
                    })),
                    backgroundColor: 'rgba(255, 99, 132, 0.6)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: { 
                        title: { display: true, text: 'Vaccination Rate (%)' }
                    },
                    y: {
                        title: { display: true, text: 'Total Vaccinations' }
                    }
                }
            }
        });

        // 3. Treemap (Countries by Total Vaccinations and Booster Dose Rate)
        const width = 800, height = 500;

        // Initialize the treemap layout with fixed size and value attribute
        const treemap = d3.layout.treemap()
            .size([width, height])
            .sticky(true)
            .value(function(d) { return d.totalVaccinations; });

        const color = d3.scale.linear()
            .domain([0, 50, 100])
            .range(["#d3d3d3", "#00ff00", "#006400"]);

        const svg3 = d3.select('#treemap-chart').append('svg')
            .attr('width', width)
            .attr('height', height);

        const nodes = treemap.nodes({children: data})
            .filter(function(d) { return !d.children; });

        const countryBlocks = svg3.selectAll('g')
            .data(nodes)
            .enter().append('g')
            .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });

        countryBlocks.append('rect')
            .attr('width', function(d) { return d.dx; })
            .attr('height', function(d) { return d.dy; })
            .style('fill', function(d) { return color(d.boosterDoseRate); })
            .style('stroke', '#fff')
            .style('stroke-width', 1);

        countryBlocks.append('text')
            .attr('x', 5)
            .attr('y', 15)
            .text(function(d) { return d.country; })
            .style('font-size', '12px')
            .style('fill', '#000');
    });
});


    </script>
    
</body>
</html>
